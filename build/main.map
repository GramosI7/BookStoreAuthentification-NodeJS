{"version":3,"sources":["webpack:///webpack/bootstrap 648fe7029306b7387e99","webpack:///external \"mongoose\"","webpack:///external \"express\"","webpack:///external \"connect-flash\"","webpack:///external \"passport\"","webpack:///./src/models/user.js","webpack:///external \"bcryptjs\"","webpack:///./src/index.js","webpack:///external \"path\"","webpack:///external \"express-validator\"","webpack:///external \"express-session\"","webpack:///./src/config/database.js","webpack:///external \"passport-local\"","webpack:///external \"express-messages\"","webpack:///./src/routes/book.js","webpack:///./src/models/book.js","webpack:///external \"multer\"","webpack:///./src/routes/user.js"],"names":["Schema","mongoose","userSchema","name","type","String","required","email","username","password","userImg","User","model","LocalStrategy","require","Strategy","app","express","connect","config","database","db","connection","on","console","error","bind","once","log","use","static","path","join","__dirname","urlencoded","extended","set","session","secret","resave","saveUninitialized","expressValidator","errorFormatter","param","msg","value","namespace","split","root","shift","formParam","length","passport","initialize","req","res","next","locals","messages","get","render","user","listen","done","query","findOne","err","message","bcrypt","compare","isMatch","serializeUser","id","deserializeUser","findById","module","exports","storage","multer","diskStorage","destination","file","cb","filename","Date","now","upload","bookRoute","Router","Book","find","books","post","single","datas","body","book","save","flash","redirect","params","_id","update","idParams","findByIdAndRemove","bookSchema","title","author","index","years","description","img","userRoute","authenticate","successRedirect","failureRedirect","failureFlash","password2","checkBody","notEmpty","isEmail","equals","errors","validationErrors","newUser","genSalt","salt","hash","logout"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 6);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 648fe7029306b7387e99","module.exports = require(\"mongoose\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mongoose\"\n// module id = 0\n// module chunks = 0","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 1\n// module chunks = 0","module.exports = require(\"connect-flash\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"connect-flash\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"passport\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"passport\"\n// module id = 3\n// module chunks = 0","import mongoose from \"mongoose\";\n\nconst Schema = mongoose.Schema;\n\nconst userSchema = new Schema({\n    name: {type: String, required: true},\n    email : { type: String, required: true},\n    username : {type : String, required: true},\n    password : {type: String, required: true},\n    userImg: {type : String, }\n})\n\nconst User = mongoose.model(\"User\", userSchema)\n\nexport { User };\n\n\n// WEBPACK FOOTER //\n// ./src/models/user.js","module.exports = require(\"bcryptjs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"bcryptjs\"\n// module id = 5\n// module chunks = 0","import express from \"express\";\nimport mongoose from \"mongoose\";\nimport path from \"path\";\nimport expressValidator from \"express-validator\";\nimport flash from \"connect-flash\";\nimport session from \"express-session\";\nimport config from \"./config/database\";\nimport passport from \"passport\";\nconst LocalStrategy = require(\"passport-local\").Strategy;\nimport {User} from \"./models/user\";\nimport bcrypt from \"bcryptjs\";\n\n\n\nconst app = express();\n\n\n// Mongoose Connection\nmongoose.connect(config.database);\nconst db = mongoose.connection;\ndb.on('error', console.error.bind(console, 'connection error:'));\ndb.once('open', function () {\n    console.log('ConnectÃ© a MongoDB !')\n});\n\n// Express Basic\napp.use(express.static(path.join(__dirname,'public')));\napp.use(express());\napp.use(express.urlencoded({extended: false}))\n\n\n// Express session\napp.set('trust proxy', 1) // trust first proxy\napp.use(session({\n  secret: 'keyboard cat',\n  resave: true,\n  saveUninitialized: true\n}));\n\n\n// Express Validator Middleware\napp.use(expressValidator({\n    errorFormatter: function(param, msg, value) {\n        var namespace = param.split('.')\n        , root    = namespace.shift()\n        , formParam = root;\n      while(namespace.length) {\n        formParam += '[' + namespace.shift() + ']';\n      }\n      return {\n        param : formParam,\n        msg   : msg,\n        value : value\n      };\n    }\n  }));\n\n// Passport Config\n// require(\"./config/passport\")(passport);\n// import \"./config/passport\"\n// Passport Middleware\napp.use(passport.initialize());\napp.use(passport.session());\n\n// Express Message\napp.use(require('connect-flash')());\napp.use(function (req, res, next) {\n  res.locals.messages = require('express-messages')(req, res);\n  next();\n});\n\n\n//PUG\napp.set(\"views\", path.join(__dirname,\"views\"));\napp.set(\"view engine\", \"pug\");\n\napp.get(\"/\", (req, res) => {\n    res.render(\"index\");\n});\n\napp.get(\"*\", (req, res, next) => {\n    res.locals.user = req.user || null;\n    console.log(res.user)\n    next();\n})\n\n\n// Folder Routes\nimport {bookRoute} from \"./routes/book\";\napp.use(\"/book\", bookRoute);\nimport {userRoute} from \"./routes/user\";\napp.use(\"/user\", userRoute);\n\n\n\n// Listen Server\napp.listen(3000, () => {\n    console.log(\"Le serveur 3000 tourne !\")\n})\n\n\n    // Local Strategy\n    passport.use(new LocalStrategy(function(username, password, done) {\n        // Match Username\n        let query = {username: username};\n        User.findOne(query, function(err, user) {\n            if(err) console.log(err);\n            if(!user){\n                return done(null, false, {message : \"No user found\"})\n            }\n\n            // Match Password\n            bcrypt.compare(password, user.password, function(err, isMatch) {\n                if(err) console.log(err)\n                if(isMatch) {\n                    return done(null, user);\n                } else {\n                    return done(null, false, {message: \"Wrong password\"})\n                }\n            });\n        })\n    }))\n    passport.serializeUser(function(user, done) {\n        done(null, user.id);\n      });\n      \n      passport.deserializeUser(function(id, done) {\n        User.findById(id, function(err, user) {\n          done(err, user);\n        });\n      });\n\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"express-validator\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express-validator\"\n// module id = 9\n// module chunks = 0","module.exports = require(\"express-session\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express-session\"\n// module id = 10\n// module chunks = 0","module.exports = {\n    database : 'mongodb://localhost/authentification-re',\n    secret : \"mysecret\"\n}\n\n\n// WEBPACK FOOTER //\n// ./src/config/database.js","module.exports = require(\"passport-local\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"passport-local\"\n// module id = 12\n// module chunks = 0","module.exports = require(\"express-messages\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express-messages\"\n// module id = 13\n// module chunks = 0","import express from \"express\";\nimport mongoose from \"mongoose\";\nimport {Book} from \"../models/book\";\nimport multer from \"multer\";\n// Config multer\nvar storage = multer.diskStorage({\n    destination: function (req, file, cb) {\n      cb(null, './src/public/uploads/')\n    },\n    filename: function (req, file, cb) {\n      cb(null, Date.now() + \"-\" + file.filename)\n    }\n  });\nvar upload = multer({ storage: storage });\nconst bookRoute = express.Router();\n\n\nbookRoute.get(\"/\", (req, res) => {\n    Book.find({}, (err, books) => {\n        if(err) console.log(err);\n        res.render(\"list_book\", {\n            books : books\n        })\n    })\n});\n\nbookRoute.get(\"/add\", (req, res) => {\n    res.render(\"add_book\")\n});\n\nbookRoute.post(\"/add\", upload.single(\"img\"), (req, res) => {\n    const datas = req.body\n    datas[\"img\"] = req.file.filename;\n    // console.log(req.body);\n    // console.log(req.file)\n    const book = new Book(datas);\n    book.save((err) => {\n        if(err)console.log(err);\n        req.flash(\"success\", \"Article Added\")\n        res.redirect(\"/book\");    \n    })\n});\n\nbookRoute.get(\"/edit/:id\", (req, res) => {\n    Book.findById(req.params.id, (err, books) => {\n        res.render(\"edit_book\", {\n            books: books\n        })\n    })\n})\n\nbookRoute.post(\"/edit/:id\", (req, res) => {\n    let id = {_id : req.params.id}\n    Book.update(id, req.body, (err) => {\n        if(err) console.log(err);\n        req.flash(\"success\", \"Article Update\")\n        res.redirect(\"/book\");\n    });\n});\n\n// Delete Book DELETE\nbookRoute.get(\"/delete/:id\", (req, res) => {\n    let idParams = {_id: req.params.id};\n    Book.findByIdAndRemove(idParams, (err) => {\n        if (err)console.log(err)\n        res.redirect(\"/book\");\n    })\n})\n\nbookRoute.get(\"/:id\", (req, res) => {\n    Book.findById(req.params.id, (err, books) => {\n        res.render(\"single_book\", {\n            books: books\n        })\n    })\n})\n\nexport {bookRoute};\n\n\n// WEBPACK FOOTER //\n// ./src/routes/book.js","import mongoose from \"mongoose\";\n\nconst Schema = mongoose.Schema;\n\nconst bookSchema = new Schema({\n    title: {type: String},\n    author : { type: String, index: true},\n    years: {type : String, index: true},\n    description : {type: String},\n    img: {type: String}\n})\n\nconst Book = mongoose.model(\"Book\", bookSchema)\n\nexport { Book };\n\n\n// WEBPACK FOOTER //\n// ./src/models/book.js","module.exports = require(\"multer\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"multer\"\n// module id = 16\n// module chunks = 0","import express from \"express\";\nconst userRoute = express.Router();\nimport bcrypt from \"bcryptjs\";\nimport passport from \"passport\";\nimport {User} from \"../models/user\";\nimport expressValidator from \"express-validator\";\n\n\nuserRoute.get(\"/login\", (req, res) => {\n    res.render(\"login\");\n});\n\nuserRoute.post(\"/login\", (req, res, next) => {\n    passport.authenticate(\"local\", {\n        successRedirect: \"/\",\n        failureRedirect: \"/user/login\",\n        failureFlash: true\n    })(req, res, next);\n})\n\nuserRoute.get(\"/register\", (req, res) => {\n    res.render(\"register\")\n})\n\nuserRoute.post(\"/register\", (req, res) => {\n    const name = req.body.name;\n    const username = req.body.username;\n    const email = req.body.email;\n    const password = req.body.password;\n    const password2 = req.body.password2;\n\n    req.checkBody(\"name\", \"Name is required\").notEmpty();\n    req.checkBody(\"username\", \"Username is required\").notEmpty();\n    req.checkBody(\"email\", \"Email is required\").isEmail();\n    req.checkBody(\"password\", \"Password is required\").notEmpty();\n    req.checkBody(\"password2\", \"Password do no match\").equals(req.body.password);\n\n    let errors = req.validationErrors();\n\n    if(errors){\n        res.render(\"register\", {\n            errors: errors\n        });\n    } else {\n        let newUser = new User({\n            name: name,\n            username : username,\n            email: email,\n            password : password\n        });\n        \n        bcrypt.genSalt(10, function(err, salt){\n            bcrypt.hash(newUser.password, salt, function(err, hash){\n                if(err){\n                    console.log(err);\n                } else {\n                    newUser.password = hash;\n                    newUser.save((err) => {\n                        if(err) {\n                            console.log(err)\n                            return;\n                        } else {\n                            req.flash(\"success\", \"You are now registered\");\n                            res.redirect(\"/user/login\");\n                        }\n                    })\n                }\n            });\n        })\n    }\n});\n\n\n// Logout\nuserRoute.get(\"/logout\", (req, res) => {\n    req.logout();\n    req.flash(\"success\", \"You are Logout\");\n    res.redirect(\"/user/login\")\n})\n\n\nexport {userRoute};\n\n\n// WEBPACK FOOTER //\n// ./src/routes/user.js"],"sourceRoot":""}